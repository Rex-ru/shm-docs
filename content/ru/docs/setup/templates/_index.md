
---
title: "Шаблоны"
---

Шаблоны позволяют генерировать как однострочные команды, так и целые блоки текста.
Эти механизмы являются основой построения взаимодействий SHM.

Синтаксис:
```{{ ОБЪЕКТ.ДАННЫЕ }}```

Например, с помощью объекта `user` можно получить доступ к данным пользователя:

* `user.id` - идентификатор пользователя
* `user.login` - логин пользователя
* `user.balance` - баланс пользователя

С помощью объекта `us` можно получить доступ к текущей услуге пользователя, и к ее данным:

* `us.expired` - дата истечения услуги
* `us.service.cost` - стоимость услуги
* `us.settings.КЛЮЧ` - читаем произвольное поле (КЛЮЧ для примера) из данных услуги

Пример шаблона команды:
```go
add_new_vpn.sh --login=vpn_{{ user.id }} --password={{ gen_store_pass() }}
```

В этом примере мы использовали специальную функцию `gen_store_pass()`, которая генерирует случайный пароль
и сохраняет его в настройках пользовательской услуги (поле `password`).

Полный список объектов вы можете найти здесь: [Объекты]({{< ref "/docs/setup/templates/objects" >}})

Полный список функций можно найти здесь: [Функции]({{< ref "/docs/setup/templates/functions" >}}).

<h2>Условия и циклы</h2>
Так же поддерживаются условия и циклы.

Это полезно, когда объект возвращает JSON, и мы хотим построить с помощью него шаблон.

Например, метод `user.pays.forecast` вернет JSON вида:
```go
{
  "items": [
    {
      "name": "Тариф хостинга",
      "expired": "2017-01-31 23:59:50",
      "total": 123.45,
    },
    {
      "name": "Регистрация домена в зоне .RU: domain.ru",
      "expired": "2017-07-29 12:39:46",
      "total": 590,
    }
  ],
  "dept": 21.56,
  "total": 713.45
}
```

Мы можем построить шаблон письма о прогнозе опаты услуг следующим образом:
```go
Уважаемый {{ user.full_name }}

Уведомляем Вас о сроках действия услуг:

{{ FOR item IN user.pays.forecast.items }}
- Услуга: {{ item.name }}
  Стоимость: {{ item.total }}
  Истекает: {{ item.expired }}
{{ END }}

{{ IF user.pays.forecast.dept }}
Погашение задолженности: {{ user.pays.forecast.dept }}
{{ END }}

Итого к оплате: {{ user.pays.forecast.total }} руб.
```

Больше информации об условиях и циклах Вы можете узнать [здесь](http://www.template-toolkit.org/docs/manual/Directives.html#section_Conditional_Processing)

